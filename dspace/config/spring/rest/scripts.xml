<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="dspaceRunnableThreadExecutor" class="org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor">
        <property name="corePoolSize" value="5"/>
    </bean>

    <!-- This primary attribute is present so that we can assure that in the REST layer we'll always use this
        bean if it is present-->
    <bean id="metadata-import" class="org.dspace.app.bulkedit.MetadataImportScriptConfiguration" primary="true">
        <property name="description" value="Import metadata after batch editing" />
        <property name="dspaceRunnableClass" value="org.dspace.app.bulkedit.MetadataImport"/>
    </bean>

    <bean id="metadata-export" class="org.dspace.app.bulkedit.MetadataExportScriptConfiguration" primary="true">
        <property name="description" value="Export metadata for batch editing"/>
        <property name="dspaceRunnableClass" value="org.dspace.app.bulkedit.MetadataExport"/>
    </bean>

    <bean id="curate" class="org.dspace.curate.CurationScriptConfiguration">
        <property name="description" value="Curation tasks"/>
        <property name="dspaceRunnableClass" value="org.dspace.curate.Curation"/>
    </bean>

    <!-- Not runnable from REST -->
    <bean id="submission-forms-migrate" class="org.dspace.submit.migration.SubmissionFormsMigrationScriptConfiguration">
        <property name="description" value="Script for migrating submission forms to DSpace 7"/>
        <property name="dspaceRunnableClass" value="org.dspace.submit.migration.SubmissionFormsMigration"/>
    </bean>
    
    <bean id="metadata-deletion" class="org.dspace.app.bulkedit.MetadataDeletionScriptConfiguration" primary="true">
        <property name="description" value="Delete all the values of the specified metadata field"/>
        <property name="dspaceRunnableClass" value="org.dspace.app.bulkedit.MetadataDeletion"/>
    </bean>

    <bean id="process-cleaner" class="org.dspace.administer.ProcessCleanerConfiguration" primary="true">
        <property name="description" value="Cleanup all the old processes in the specified state"/>
        <property name="dspaceRunnableClass" value="org.dspace.administer.ProcessCleaner"/>
    </bean>

    <bean id="bulk-import" class="org.dspace.app.bulkedit.BulkImportScriptConfiguration" primary="true">
        <property name="description" value="Perform the bulk import of an excel file with a list of item to add, update or remove"/>
        <property name="dspaceRunnableClass" value="org.dspace.app.bulkedit.BulkImport"/>
    </bean>
    
    <bean id="item-export" class="org.dspace.content.integration.crosswalks.script.ItemExportScriptConfiguration" primary="true">
        <property name="description" value="Perform the item export in the given format"/>
        <property name="dspaceRunnableClass" value="org.dspace.content.integration.crosswalks.script.ItemExport"/>
    </bean>

    <bean id="bulk-item-export" class="org.dspace.content.integration.crosswalks.script.BulkItemExportScriptConfiguration" primary="true">
        <property name="description" value="Perform the multiple items export in the given format"/>
        <property name="dspaceRunnableClass" value="org.dspace.content.integration.crosswalks.script.BulkItemExport"/>
    </bean>
    
    <bean id="collection-export" class="org.dspace.app.bulkedit.CollectionExportScriptConfiguration" primary="true">
        <property name="description" value="Perform the export of all the archived items of the given collection in xls format"/>
        <property name="dspaceRunnableClass" value="org.dspace.app.bulkedit.CollectionExport"/>
    </bean>

    <bean id="import-nbevents" class="org.dspace.app.nbevent.NBEventsScriptConfiguration" primary="true">
        <property name="description" value="Import new openAIRE notification broker events"/>
        <property name="dspaceRunnableClass" value="org.dspace.app.nbevent.NBEventsRunnable"/>
     </bean>

    <bean id="import-oaire-suggestions" class="org.dspace.app.suggestion.OAIREPublicationLoaderScriptConfiguration" primary="true">
        <property name="description" value="Import and store locally metadata from OpenAIRE"/>
        <property name="dspaceRunnableClass" value="org.dspace.app.suggestion.OAIREPublicationLoaderRunnable"/>
    </bean>
    
    <bean id="orcid-bulk-push" class="org.dspace.orcid.script.OrcidBulkPushScriptConfiguration" primary="true">
        <property name="description" value="Perform the bulk synchronization of all the BATCH configured ORCID entities placed in the ORCID queue"/>
        <property name="dspaceRunnableClass" value="org.dspace.orcid.script.OrcidBulkPush"/>
    </bean>
    
    <bean id="orcid-bulk-pull" class="org.dspace.orcid.script.OrcidBulkPullScriptConfiguration" primary="true">
        <property name="description" value="Perform a bulk pull from the ORCID registry for all the profiles with an ORCID id set"/>
        <property name="dspaceRunnableClass" value="org.dspace.orcid.script.OrcidBulkPull"/>
    </bean>

    <bean id="harvest" class="org.dspace.app.harvest.HarvestScriptConfiguration">
        <property name="description" value="Manage the OAI-PMH harvesting of external collections"/>
        <property name="dspaceRunnableClass" value="org.dspace.app.harvest.Harvest"/>
    </bean>

    <bean id="cris-layout-tool" class="org.dspace.layout.script.CrisLayoutToolScriptConfiguration" primary="true">
        <property name="description" value="Script to import CRIS layout configuration from excel file"/>
        <property name="dspaceRunnableClass" value="org.dspace.layout.script.CrisLayoutToolScript"/>
    </bean>
    
    <bean name="metadata-export-search" class="org.dspace.app.bulkedit.MetadataExportSearchScriptConfiguration">
        <property name="description" value="export metadata from a discovery search" />
        <property name="dspaceRunnableClass" value="org.dspace.app.bulkedit.MetadataExportSearch" />
    </bean>

    <bean id="import" class="org.dspace.app.itemimport.ItemImportScriptConfiguration" primary="true">
        <property name="description" value="Batch Import from Simple Archive Format (SAF)" />
        <property name="dspaceRunnableClass" value="org.dspace.app.itemimport.ItemImport"/>
    </bean>

    <bean id="export" class="org.dspace.app.itemexport.ItemExportScriptConfiguration" primary="true">
        <property name="description" value="Batch Export to Simple Archive Format (SAF)"/>
        <property name="dspaceRunnableClass" value="org.dspace.app.itemexport.ItemExport"/>
    </bean>

    <!-- VERSIONING ACTIONS CONFIGURATION -->
    <bean id="capture-website-token" class="org.dspace.app.capture.mapper.PropertiesHeaderValueMapper">
        <constructor-arg name="propertyName" value="capture-website.jwt.token"/>
        <constructor-arg name="defaultValue"><null/></constructor-arg>
        <constructor-arg name="prefix" value="Bearer"/>
    </bean>
    
   <bean id="context-user-mapper" class="org.dspace.app.capture.mapper.ContextUserHeaderValueMapper"/>
    
    <bean id="capture-website-headers" class="java.util.HashMap">
        <constructor-arg>
            <map>
                <entry 
                    key="Authorization"
                    value-ref="capture-website-token"
                />
                <entry 
                    key="X-On-Behalf-Of"
                    value-ref="context-user-mapper"
                />
            </map>
        </constructor-arg>
    </bean>
    
    <bean id="impactpathway-capturable" class="org.dspace.app.capture.model.CapturableScreenConfiguration">
        <constructor-arg name="element" value="#ipw"/>
        <constructor-arg name="removeElements" value="ds-admin-sidebar,ds-themed-header-navbar-wrapper"/>
        <constructor-arg name="style" value="#ipw { width:100vw;height:100vw }"/>
        <constructor-arg name="type" value="jpeg"/>
        <constructor-arg name="scale" value="1"/>
        <constructor-arg name="headersConfiguration" ref="capture-website-headers"/>
    </bean>
    
    <bean id="impactpathway-discovery" class="org.dspace.app.versioning.model.DiscoveryRelationItemProvider">
        <!-- RELATION.Project.impactpathway -->
        <constructor-arg name="relationName" value="impactpathway"/>
    </bean>
    
    <bean id="impactpathway-url" class="org.dspace.app.versioning.action.capture.mapper.SimplePrintableViewItemUrlMapper">
        <constructor-arg name="baseUrl" value="entities/impactpathway"/>
    </bean>
    
    <bean id="IMPACTPATHWAY" class="org.dspace.app.versioning.action.capture.CaptureScreenActionConfiguration">
        <constructor-arg name="configuration" ref="impactpathway-capturable"/>
        <constructor-arg name="bundleName" value="IMPACTPATHWAY"/>
        <constructor-arg name="itemProvider" ref="impactpathway-discovery"/>
        <constructor-arg name="itemUrlMapper" ref="impactpathway-url"/>
    </bean>
    
   <bean id="workingplan-capturable" class="org.dspace.app.capture.model.CapturableScreenConfiguration">
        <constructor-arg name="element"><null/></constructor-arg>
        <constructor-arg name="removeElements"><null/></constructor-arg>
        <constructor-arg name="style"><null/></constructor-arg>
        <constructor-arg name="type" value="jpeg"/>
        <constructor-arg name="scale" value="1"/>
        <constructor-arg name="headersConfiguration" ref="capture-website-headers"/>
    </bean>
    
    <bean id="workingplan-authority" class="org.dspace.app.versioning.model.MetadataAuthorityItemProvider">
        <constructor-arg name="metadataField" value="synsicris.relation.workingplan"/>
    </bean>
    
    <bean id="workingplan-url" class="org.dspace.app.versioning.action.capture.mapper.AuthorityRelatedItemUrlMapper">
        <constructor-arg name="baseUrl" value="entities/project"/>
        <constructor-arg name="relationMetadata" value="synsicris.relation.project"/>
        <constructor-arg name="suffix" value="workingplan"/>
    </bean>
    
    <bean id="WORKINGPLAN" class="org.dspace.app.versioning.action.capture.CaptureScreenActionConfiguration">
        <constructor-arg name="configuration" ref="workingplan-capturable"/>
        <constructor-arg name="bundleName" value="WORKINGPLAN"/>
        <constructor-arg name="itemProvider" ref="workingplan-authority"/>
        <constructor-arg name="itemUrlMapper" ref="workingplan-url"/>
    </bean>
    
<!--     <bean id="EXPLOITATIONPLAN" class="org.dspace.app.versioning.action.capture.CaptureScreenActionConfiguration"> -->
<!--         <property name="bundleName" value="EXPLOITATIONPLAN"/> -->
<!--         <property name="mapper" ref=""/> -->
<!--         <property name="itemProvider" ref=""/> -->
<!--     </bean> -->
    
<!--     <bean id="INTERIMREPORT" class="org.dspace.app.versioning.action.capture.CaptureScreenActionConfiguration"> -->
<!--         <property name="bundleName" value="INTERIMREPORT"/> -->
<!--         <property name="mapper" ref=""/> -->
<!--         <property name="itemProvider" ref=""/> -->
<!--     </bean> -->
        
    <bean id="versioning-actions" class="java.util.ArrayList">
        <constructor-arg>
            <list>
                <ref bean="IMPACTPATHWAY" />
                <ref bean="WORKINGPLAN" />                
            </list>
        </constructor-arg>
    </bean>
    
    <bean id="version" class="org.dspace.app.versioning.ItemVersionScriptConfiguration">
        <property name="description" value="Creates a new version of a target item"/>
        <property name="dspaceRunnableClass" value="org.dspace.app.versioning.ItemVersionScript"/>
        <property name="actions" ref="versioning-actions"/>
    </bean>
    
    <!-- VERSIONING ACTIONS CONFIGURATION -->
    
    <bean id="capture-website" class="org.dspace.app.capture.CaptureWebsiteScriptConfiguration">
        <property name="description" value="Creates a screenshot of a target dspace page"/>
        <property name="dspaceRunnableClass" value="org.dspace.app.capture.CaptureWebsiteScript"/>
    </bean>
</beans>
